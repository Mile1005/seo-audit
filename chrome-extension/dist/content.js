import"./overlay.js";import"./assets/hooks.module-DmjZGBvZ.js";import"./sidebar.js";const $={"missing-alt":{wcagRef:"1.1.1"}};function L(){return[]}function R(){return[]}function q(){const e=[];document.querySelectorAll("img").forEach((n,o)=>{const c=n.getAttribute("alt"),g=n.getAttribute("role"),p=n.getAttribute("aria-hidden");g==="presentation"||p==="true"||(c===null||c==="")&&e.push({id:`img-alt-${o}`,category:"error",severity:"error",ruleId:"missing-alt",message:"Image missing alt text",why:"Images must have alt text for accessibility.",recommendation:"Add a meaningful alt attribute.",selector:u(n),snippet:n.outerHTML,wcagRef:$["missing-alt"].wcagRef,bbox:n.getBoundingClientRect()})});const t=Array.from(document.querySelectorAll("h1, h2, h3, h4, h5, h6")),r=t.filter(n=>n.tagName.toLowerCase()==="h1");r.length===0&&e.push({id:"heading-no-h1",category:"structure",severity:"warning",ruleId:"no-h1",message:"No <h1> found",why:"Every page should have a single <h1> for structure.",recommendation:"Add a unique <h1> heading.",selector:"body"}),r.length>1&&e.push({id:"heading-multi-h1",category:"structure",severity:"warning",ruleId:"multi-h1",message:"Multiple <h1> elements found",why:"There should be only one <h1> per page.",recommendation:"Keep only one <h1>.",selector:r.map(n=>u(n)).join(", ")});let s=0;t.forEach((n,o)=>{const c=parseInt(n.tagName[1]);s&&c>s+1&&e.push({id:`heading-skip-${o}`,category:"structure",severity:"warning",ruleId:"heading-skip",message:`Heading level skipped: ${n.tagName}`,why:"Headings should not skip levels.",recommendation:"Use proper heading order.",selector:u(n)}),s=c});const a=["main","nav","header","footer","aside"];let i=!1;a.forEach(n=>{const o=document.querySelectorAll(n);n==="main"&&o.length>0&&(i=!0),o.length>1&&e.push({id:`landmark-dup-${n}`,category:"structure",severity:"warning",ruleId:"landmark-dup",message:`Duplicate <${n}> landmarks`,why:`There should be only one <${n}> landmark per page.`,recommendation:`Keep only one <${n}> landmark element per page.`,selector:Array.from(o).map(u).join(", ")})}),i||e.push({id:"landmark-no-main",category:"structure",severity:"warning",ruleId:"no-main",message:"No <main> landmark found",why:"Every page should have a <main> landmark.",recommendation:"Add a <main> element.",selector:"body"}),document.querySelectorAll("input, select, textarea").forEach((n,o)=>{const c=n.getAttribute("id"),g=c&&document.querySelector(`label[for="${c}"]`),p=n.getAttribute("aria-labelledby");!g&&!p&&e.push({id:`form-label-${o}`,category:"aria",severity:"warning",ruleId:"form-label",message:"Form field missing label",why:"Form fields must have associated labels.",recommendation:"Add a <label> or aria-labelledby.",selector:u(n)})}),document.querySelectorAll("fieldset").forEach((n,o)=>{n.querySelector("legend")||e.push({id:`fieldset-no-legend-${o}`,category:"aria",severity:"info",ruleId:"fieldset-no-legend",message:"Fieldset missing legend",why:"Fieldsets should have a <legend> for context.",recommendation:"Add a <legend> to the fieldset.",selector:u(n)})}),document.querySelectorAll("a,button").forEach((n,o)=>{const c=n.textContent?.trim()||"";n.tagName.toLowerCase()==="a"&&c===""&&e.push({id:`anchor-empty-${o}`,category:"error",severity:"error",ruleId:"anchor-empty",message:"Anchor has no accessible name",why:"Links must have accessible text.",recommendation:"Add descriptive text to the link.",selector:u(n)}),/click here|read more|more info/i.test(c)&&e.push({id:`anchor-redundant-${o}`,category:"alert",severity:"info",ruleId:"anchor-redundant",message:"Link/button has redundant text",why:"Avoid generic link text.",recommendation:"Use descriptive link text.",selector:u(n)})}),document.querySelectorAll("[role]").forEach((n,o)=>{const c=n.getAttribute("role");(!c||!T(c))&&e.push({id:`aria-invalid-role-${o}`,category:"aria",severity:"warning",ruleId:"aria-invalid-role",message:`Invalid ARIA role: ${c}`,why:"Element has an invalid ARIA role.",recommendation:"Use a valid ARIA role.",selector:u(n)})});const l=L();return e.push(...l),e}function u(e){if(!e)return"";let t=e.tagName.toLowerCase();return e.id&&(t+=`#${e.id}`),e.className&&typeof e.className=="string"&&(t+="."+e.className.split(" ").join(".")),t}function T(e){return["button","checkbox","dialog","grid","link","listbox","menu","menubar","menuitem","option","progressbar","radio","radiogroup","scrollbar","slider","spinbutton","status","switch","tab","tabpanel","textbox","timer","tooltip","tree","treeitem","main","navigation","banner","complementary","contentinfo","form","region","search","alert","log","marquee","status","timer","alertdialog","application","article","cell","columnheader","definition","directory","document","feed","figure","group","heading","img","list","listitem","math","none","note","presentation","row","rowgroup","rowheader","separator"].includes(e)}function N(){const e=document.title||"",t=document.querySelector('meta[name="description"]')?.getAttribute("content")||"",s=document.createElement("canvas").getContext("2d");s.font="bold 18px Arial";let a=0,i=e;for(let o=0;o<e.length;o++)if(a=s.measureText(e.slice(0,o+1)).width,a>600){i=e.slice(0,o)+"…";break}s.font="normal 14px Arial";let l=0,n=t;for(let o=0;o<t.length;o++)if(l=s.measureText(t.slice(0,o+1)).width,l>920){n=t.slice(0,o)+"…";break}return{title:e,titleTrunc:i,meta:t,metaTrunc:n}}function P(e){const t=[/\bwhat is\b/i,/\bhow to\b/i,/\bwhy\b/i,/\bwho\b/i,/\bwhen\b/i,/\bwhere\b/i,/\bdefinition\b/i,/\bmeaning\b/i,/\bexplained\b/i,/\bguide\b/i,/\bfaq\b/i,/\bquestion\b/i];let r=0,s=0;return e.forEach(a=>{t.some(i=>i.test(a.textContent||""))&&s++}),e.length&&(r=Math.round(s/e.length*100)),{score:r,matches:s,total:e.length}}function M(){const e=Array.from(document.querySelectorAll("a[href]"));let t=0,r=0;const s=[];e.forEach(o=>{const c=o.getAttribute("href")||"";/^https?:\/\//.test(c)&&!c.includes(location.hostname)?r++:t++,s.push((o.textContent||"").trim())});const a=e.length?t/e.length:0,i=new Set(s.filter(Boolean)).size,l=s.filter(o=>!o).length,n=s.filter(o=>/click here|read more|more info/i.test(o)).length;return{total:e.length,internal:t,external:r,ratio:a,unique:i,empty:l,generic:n}}function w(){const e=q(),t=R(),r={},s={},a=Array.from(document.querySelectorAll("h1, h2, h3, h4, h5, h6")),i={errorCount:e.filter(l=>l.severity==="error").length,warningCount:e.filter(l=>l.severity==="warning").length,infoCount:e.filter(l=>l.severity==="info").length,total:e.length,serpPreview:N(),headingAnswerability:P(a),linkAnalysis:M()};return{issues:e,summary:i,structure:t,order:r,contrast:s}}const k={error:"#ef4444",alert:"#eab308",feature:"#22c55e",structure:"#3b82f6",aria:"#a21caf"};let f=null;function z(e,t){f&&(f.remove(),f=null);const r=document.querySelector(e);if(!r)return;const s=r.getBoundingClientRect(),a=document.createElement("div");a.className="seo-audit-highlight",a.style.position="fixed",a.style.left=`${window.scrollX+s.left-4}px`,a.style.top=`${window.scrollY+s.top-4}px`,a.style.width=`${s.width+8}px`,a.style.height=`${s.height+8}px`,a.style.border=`2px dashed ${k[t]}`,a.style.zIndex="2147483647",a.style.pointerEvents="none",a.style.background="rgba(0,0,0,0.03)";const i=document.createElement("div");i.textContent=t.toUpperCase(),i.style.position="absolute",i.style.top="-20px",i.style.left="0",i.style.background=k[t],i.style.color="#fff",i.style.fontSize="12px",i.style.padding="2px 8px",i.style.borderRadius="4px",i.style.fontWeight="bold",a.appendChild(i),document.body.appendChild(a),f=a,r.scrollIntoView({behavior:"smooth",block:"center"})}const K={error:"#ef4444",alert:"#eab308",feature:"#22c55e",structure:"#3b82f6",aria:"#a21caf"};let d=null;function U(){d||(d=document.createElement("div"),d.className="seo-audit-badge-overlay",d.style.position="fixed",d.style.top="0",d.style.left="0",d.style.width="100vw",d.style.height="100vh",d.style.pointerEvents="none",d.style.zIndex="2147483646",document.body.appendChild(d))}function x(){d&&(d.innerHTML="")}function O(e){U(),x(),e.forEach(t=>{if(!t.bbox)return;const r=document.createElement("div");r.className=`seo-audit-badge seo-audit-badge-${t.category}`,r.textContent="!",r.style.position="absolute",r.style.left=`${window.scrollX+t.bbox.left-18}px`,r.style.top=`${window.scrollY+t.bbox.top-18}px`,r.style.width="20px",r.style.height="20px",r.style.background=K[t.category],r.style.color="#fff",r.style.borderRadius="50%",r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",r.style.fontWeight="bold",r.style.fontSize="14px",r.style.boxShadow="0 2px 8px #0006",r.style.cursor="pointer",r.style.pointerEvents="auto",r.title=`${t.severity.toUpperCase()}: ${t.message}`,r.onclick=s=>{s.stopPropagation(),z(t.selector,t.category),window.dispatchEvent(new CustomEvent("seo-audit-open-issue",{detail:{issueId:t.id}}))},d.appendChild(r)})}window.addEventListener("scroll",()=>{},!0);window.addEventListener("resize",()=>{},!0);let V=null,H=null,B=null;if("PerformanceObserver"in window)try{new PerformanceObserver(a=>{const i=a.getEntries(),l=i[i.length-1];l&&l.startTime&&(V=l.startTime)}).observe({type:"largest-contentful-paint",buffered:!0});let t=0;new PerformanceObserver(a=>{for(const i of a.getEntries())i.hadRecentInput||(t+=i.value);H=t}).observe({type:"layout-shift",buffered:!0}),new PerformanceObserver(a=>{const i=a.getEntries(),l=i[i.length-1];l&&l.startTime&&(B=l.startTime)}).observe({type:"event",buffered:!0})}catch{}let h=!1,m=!1,y=null,v=!1,S=location.href,b=null;function E(e){v||(O(e.issues),window.dispatchEvent(new CustomEvent("seo-audit-analysis",{detail:{result:e}})),h=!0,v=!0,chrome.storage.sync.set({overlayVisible:!0}))}function Y(){x(),window.dispatchEvent(new CustomEvent("seo-audit-close-sidebar")),h=!1,v=!1,chrome.storage.sync.set({overlayVisible:!1})}function j(){h?Y():E(y||{issues:[]})}function A(){window.dispatchEvent(new CustomEvent("seo-audit-open-sidebar")),m=!0,chrome.storage.sync.set({sidebarOpen:!0})}function D(){window.dispatchEvent(new CustomEvent("seo-audit-close-sidebar")),m=!1,chrome.storage.sync.set({sidebarOpen:!1})}function F(){m?D():A()}function I(){b&&clearTimeout(b),b=window.setTimeout(()=>{const e=w();y=e,h&&(x(),O(e.issues),window.dispatchEvent(new CustomEvent("seo-audit-analysis",{detail:{result:e}})))},400)}chrome.runtime.onMessage.addListener((e,t,r)=>{if(e&&e.type==="ANALYZE"){const s=w();y=s,E(s),A()}});window.addEventListener("keydown",e=>{e.altKey&&e.shiftKey&&e.code==="KeyO"&&j(),e.altKey&&e.shiftKey&&e.code==="KeyS"&&F()});chrome.storage.sync.get(["overlayVisible","sidebarOpen"],e=>{if(h=!!e.overlayVisible,m=!!e.sidebarOpen,h){const t=w();y=t,E(t)}m&&A()});const G=new MutationObserver(()=>{I()});G.observe(document.body,{childList:!0,subtree:!0,attributes:!0});function C(){location.href!==S&&(S=location.href,I())}const W=history.pushState;history.pushState=function(...e){W.apply(this,e),C()};const X=history.replaceState;history.replaceState=function(...e){X.apply(this,e),C()};window.addEventListener("popstate",C);
//# sourceMappingURL=content.js.map
